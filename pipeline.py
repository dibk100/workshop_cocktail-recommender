from langgraph.graph import StateGraph, START, END
from nodes.task_classifier import *
from nodes.graph_nodes import graph_query_node
from nodes.llm_response import llm_response_node
from nodes.response_node import response_node
from core.schemas import PipelineState

def build_pipeline_graph() -> StateGraph:
    graph = StateGraph(PipelineState)
    
    graph.add_node("TASK_mapping", task_mapping_node)
    graph.add_node("Agent_TaskClassification", llm_task_node)
    graph.add_node("Retriver", graph_query_node)
    graph.add_node("Agent_CheckingHop", llm_response_node)
    graph.add_node("ResponseFormatter", response_node)
    
    # ê¸°ë³¸ í”Œë¡œìš°
    graph.add_edge(START, "TASK_mapping")
    graph.add_edge("TASK_mapping", "Agent_TaskClassification")
    graph.add_edge("Agent_TaskClassification", "Retriver")
    
    # Retriever â†” CheckingHop ë£¨í”„
    graph.add_edge("Retriver", "Agent_CheckingHop")
    graph.add_edge("Agent_CheckingHop", "Retriver")   # ë£¨í”„ ì¶”ê°€
    
    # ê²°ê³¼ ì¶œë ¥
    graph.add_edge("Retriver", "ResponseFormatter")
    graph.add_edge("ResponseFormatter", END)
    
    return graph


def interface_cli():
    """
    CLI ê¸°ë°˜ ì¹µí…Œì¼ ì¶”ì²œ ì‹œìŠ¤í…œ í™”ë©´ ::::::: ìˆ˜ì •í•´ì•¼í•¨
    """
    print("\n=== ğŸ¸ Cocktail Recommendation System ğŸ¸ ===")
    print("Type your query to get a cocktail recommendation or type 'q' to quit.\n")


if __name__ == "__main__":
    interface_cli()